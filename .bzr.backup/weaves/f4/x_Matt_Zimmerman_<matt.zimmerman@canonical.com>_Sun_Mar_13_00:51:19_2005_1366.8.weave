# bzr weave file v5
i
1 59def9ea70e3c44160694c2ed23df94723478d5d
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--base-0

i
1 bdb6bebcea2ca96ce7f671f8b0ad14e1fd5852df
n Arch-1:matt.zimmerman@canonical.com--2004%casper--main--0--base-0

i 1
1 59def9ea70e3c44160694c2ed23df94723478d5d
n Arch-1:colin.watson@canonical.com--2005%casper--debconf-copydb--0--patch-1

i 1
1 05ab2fa0d52e36fce54f94982d2075c853113f4e
n Arch-1:colin.watson@canonical.com--2005%casper--translations--0--patch-17

i 1
1 59def9ea70e3c44160694c2ed23df94723478d5d
n Arch-1:matt.zimmerman@canonical.com--2004%casper--main--0--patch-25

i 4 0
1 88e95c32278ca7ad50996bd69447ba7d0b0a0e4d
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-6

i 5
1 c9bc6e4232d28678466fa035a08cdf5f3eaab2d3
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-11

i 6
1 c52cd02d05c0847548e2b58fb888f6751be159b2
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-12

i 7
1 c6e5b84fefcf7aaf90f76f02f78d357b5ed61015
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-14

i 8
1 61807ce9d772b28296b9eefc8eacdb9b96c37d44
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-15

i 9
1 acfbd11500e103f2c21e5cc010323a92ef8c0abb
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-16

i 10
1 117dae6211e98ff3aed2888d03019e025bd495ee
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-19

i 11
1 01ef6d15d6ea4b542863aec4042a87668e932ae3
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-21

i 12
1 05ab2fa0d52e36fce54f94982d2075c853113f4e
n Arch-1:matt.zimmerman@canonical.com%casper--breezy--0--patch-1

i 12
1 05ab2fa0d52e36fce54f94982d2075c853113f4e
n Arch-1:matt.zimmerman@canonical.com%casper--main--0--patch-24

i 14 13
1 05ab2fa0d52e36fce54f94982d2075c853113f4e
n mdz@mizar-20051205230117-c327e75be767f237

i 15
1 05ab2fa0d52e36fce54f94982d2075c853113f4e
n tfheen@ubuntu.com-20051214123713-b0c607646607b738

i 16
1 d42048f51b124f4febb457b31ff4512dfe8c6845
n tfheen@ubuntu.com-20051214124305-81e6c50220b71a59

i 17
1 2adaf9195c5e531249584dcf1e16bf28eeaa1dd1
n tfheen@ubuntu.com-20051214124642-89138620ced37930

i 18
1 a47684d5d080a36666a6b1f770c623df027dc74d
n tfheen@ubuntu.com-20051214125903-ace67dae9d783dc3

i 19
1 5d78fad154ac317ba6d5ccfa0e29f2607b651162
n tfheen@ubuntu.com-20051215132358-5f6927957f0c57a5

i 20
1 5b48e328ecfe13d74f56623210b2a20216bec576
n tfheen@ubuntu.com-20051215134309-599259b94b02fc3a

i 21
1 645366e8516df85a631ac2d130ba53657436ff91
n tfheen@ubuntu.com-20051215135854-99620ceaae1ac6fe

i 22
1 e49246339c0fdff79b3abb6666b03489a8960f30
n tfheen@ubuntu.com-20051215141516-3dd54c4b9cb56234

i 23
1 4e8cc6c1a10d86ab5b1178071819e0e7de7b1729
n tfheen@ubuntu.com-20051215142724-3e8dab86646cde0d

i 24
1 58fa145070424afd69ad46d7829f1691ac3f7b05
n tfheen@ubuntu.com-20051215144929-f0508f79b0475a1c

i 25
1 c2e24346976787bf3bac6fad5de6239575f41035
n tfheen@ubuntu.com-20051219132042-a0f399338aaacf39

i 26
1 f3a002e7e05977732ec5d9a1c9715dc7d49031d4
n tfheen@ubuntu.com-20060102101900-7623af6089bd9092

i 27
1 0fc29dc621365443151049b5f9b5b6097938c5ef
n tfheen@ubuntu.com-20060103153417-5b1d1e9db0cea007

i 28
1 7511d32353d414d8312710a2af437a7d4239e9db
n tfheen@ubuntu.com-20060104115653-bc7d9af14a7f490f

i 29
1 8e84162e03bbe30c6e8672d5e42212b84a683620
n tfheen@ubuntu.com-20060106132121-76c1766fab8652e8

i 30
1 042d95f234a1097043937ed9ef67ca5779fe19af
n tfheen@ubuntu.com-20060110093740-3067387b91e09676

i 30
1 042d95f234a1097043937ed9ef67ca5779fe19af
n tfheen@ubuntu.com-20060110094537-060e7579ee3ebe05

i 32
1 5bec9bbc427ce87927eae58642d0ede44323621a
n colin.watson@canonical.com-20060120164015-92ddf1445fdd4acf

i 33
1 4754ad863aff8e6f68d4ebc6a0ce6e40e252f300
n tfheen@ubuntu.com-20060421124950-5f003d09a0d7c145

i 34
1 e1b47d1e855557267fb0eb3bca8648ab360bef9e
n tfheen@ubuntu.com-20060421140219-3ce5260d15ed23d6

i 35
1 f5ef1aa0476660102fbdc3b3ff4946446ad47be5
n colin.watson@canonical.com-20060510155341-44c4f96df724edaf

i 36
1 d1712e74f755176fdd53f84774bec0ad5aff4482
n tfheen@ubuntu.com-20060511101145-7eff26852b90d05c

w
{ 0
. #!/bin/sh
. 
{ 18
. PREREQ=""
{ 31
. DESCRIPTION="Configuring X"
. 
. . /scripts/functions
}
{ 32
[ 37
. DESCRIPTION="Configuring X"
] 37
{ 37
. DESCRIPTION="Configuring X..."
}
. 
. . /scripts/functions
}
. 
. prereqs()
. {
.        echo "$PREREQ"
. }
. 
. case $1 in
. # get pre-requisites
. prereqs)
.        prereqs
.        exit 0
.        ;;
. esac
[ 26
. set -x
}
] 26
{ 26
{ 31
. 
. log_begin_msg "$DESCRIPTION"
}
{ 32
. 
. log_begin_msg "$DESCRIPTION"
}
. 
}
. if [ "$TERM_TYPE" = "serial" ]; then
.     # Don't bother trying to configure or start X on a serial console
.     rm -f /etc/rc?.d/S??[gxk]dm
.     exit 0
. fi
. 
[ 5
. debconf-copydb -p '^debian-installer/keymap$' configdb target_configdb
] 5
{ 5
[ 17
. . /usr/share/debconf/confmodule
] 17
{ 17
{ 19
{ 20
{ 27
. locale=en_US.UTF-8
. 
}
. for x in $(cat /proc/cmdline); do
.                 case $x in
.                         debian-installer/locale=*)
.                                 locale=${x#debian-installer/locale=}
.                                 ;;
.                 esac
. done
}
. 
. mount -n -o bind /sys /root/sys
. mount -n -o bind /proc /root/proc
}
[ 20
. casper-reconfigure xserver-xorg
}
[ 19
. 
[ 6
. db_register debian-installer/dummy xserver-xorg/force_keyboard_detection
. db_set xserver-xorg/force_keyboard_detection true
. db_fset xserver-xorg/force_keyboard_detection seen true
] 6
{ 6
[ 8
. db_register debian-installer/dummy xserver-xorg/autodetect_keyboard
. db_set xserver-xorg/autodetect_keyboard true
. db_fset xserver-xorg/autodetect_keyboard seen true
}
] 8
{ 8
[ 12
. # XXX
. # Copy information from cdebconf to debconf. This is a horrible hack around
. # the lack of a debconf-copydb that works with cdebconf's rfc822db.
. target_debconf () {
.         env -u DEBIAN_HAS_FRONTEND -u DEBIAN_FRONTEND \
.                 -u DEBCONF_REDIR -u DEBCONF_OLD_FD_BASE \
.                 DEBCONF_READFD=0 DEBCONF_WRITEFD=3 \
.                 debconf -o d-i "$@"
. }
[ 9
. for q in debian-installer/keymap; do
] 9
{ 9
. 
{ 10
. 
. db_register debian-installer/dummy xserver-xorg/autodetect_keyboard
}
. db_set xserver-xorg/autodetect_keyboard true
. db_fset xserver-xorg/autodetect_keyboard seen true
. 
. for q in debian-installer/keymap xserver-xorg/autodetect_keyboard; do
}
.         db_get "$q" || continue
.         value="$RET"
.         db_fget "$q" seen
.         seen="$RET"
.         target_debconf sh -c '
.                 . /usr/share/debconf/confmodule
.                 db_register "$1" "$1"
.                 db_set "$1" "$2"
.                 db_fset "$1" seen "$3"' debconf "$q" "$value" "$seen"
. done
}
. 
[ 6
. debconf-copydb -p '^(debian-installer/keymap|xserver-xorg/force_keyboard_detection$' configdb target_configdb
}
] 6
{ 6
[ 7
. debconf-copydb -p '^(debian-installer/keymap|xserver-xorg/autodetect_keyboard$' configdb target_configdb
}
] 7
{ 7
[ 8
. debconf-copydb -p '^(debian-installer/keymap|xserver-xorg/autodetect_keyboard)$' configdb target_configdb
}
] 8
{ 10
. #DEBUG_XORG_DEBCONF=yes
. #export DEBUG_XORG_DEBCONF
}
{ 11
. 
. # XXX workaround for bug #13523
. (cd /dev; MAKEDEV console)
}
] 12
[ 13
[ 14
. casper-reconfigure -fpassthrough xserver-xorg
}
{ 1
[ 5
. #!/bin/sh
. 
. if [ "$TERM_TYPE" = "serial" ]; then
.     # Don't bother trying to configure or start X on a serial console
.     rm -f /etc/rc?.d/S??[gxk]dm
.     exit 0
. fi
. 
[ 2
[ 4
. . /usr/share/debconf/confmodule
. 
[ 3
. # XXX
. # Copy information from cdebconf to debconf. This is a horrible hack around
. # the lack of a debconf-copydb that works with cdebconf's rfc822db.
. target_debconf () {
.         env -u DEBIAN_HAS_FRONTEND -u DEBIAN_FRONTEND \
.                 -u DEBCONF_REDIR -u DEBCONF_OLD_FD_BASE \
.                 DEBCONF_READFD=0 DEBCONF_WRITEFD=3 \
.                 debconf -o d-i "$@"
. }
. 
. for q in debian-installer/keymap; do
.         db_get "$q" || continue
.         value="$RET"
.         db_fget "$q" seen
.         seen="$RET"
.         target_debconf sh -c '
.                 . /usr/share/debconf/confmodule
.                 db_register "$1" "$1"
.                 db_set "$1" "$2"
.                 db_fset "$1" seen "$3"' debconf "$q" "$value" "$seen"
. done
. 
] 2
{ 2
. debconf-copydb -p '^debian-installer/keymap$' configdb target_configdb
}
] 4
{ 4
. debconf-copydb -p '^debian-installer/keymap$' configdb target_configdb
}
. casper-reconfigure -fpassthrough xserver-xorg
}
] 3
{ 3
. DEBUG_XORG_PACKAGE=yes \
.     casper-reconfigure -fpassthrough xserver-xorg
}
] 5
{ 10
[ 12
. 
}
] 12
] 13
{ 13
. DEBUG_XORG_PACKAGE=yes \
.     casper-reconfigure -fpassthrough xserver-xorg
}
] 14
{ 14
[ 17
. DEBUG_XORG_PACKAGE=yes \
.     casper-reconfigure -fpassthrough xserver-xorg
}
] 17
] 19
{ 19
] 20
{ 20
[ 21
. LANG=$(grep ^$locale /root/usr/share/i18n/SUPPORTED | head -n 1 | cut -d\  -f 1) casper-reconfigure xserver-xorg
}
] 21
{ 21
{ 22
. 
[ 23
. chroot /root /bin/sh <<EOF
. . /usr/share/debconf/confmodule
. db_set xserver-xorg/autodetect_keyboard true
. EOF
] 23
{ 23
[ 24
. DEBIAN_FRONTEND=noninteractive chroot /root /bin/sh -c '. /usr/share/debconf/confmodule ; db_set xserver-xorg/autodetect_keyboard true'
}
] 24
{ 24
[ 28
. echo set xserver-xorg/autodetect_keyboard true | chroot /root debconf-communicate -fnoninteractive
}
{ 25
. echo fset xserver-xorg/autodetect_keyboard seen true | chroot /root debconf-communicate -fnoninteractive
}
] 28
{ 28
[ 29
. echo set xserver-xorg/autodetect_keyboard true | chroot /root debconf-communicate -fnoninteractive > /dev/null
. echo fset xserver-xorg/autodetect_keyboard seen true | chroot /root debconf-communicate -fnoninteractive > /dev/null
}
] 29
{ 29
[ 30
. DEBCONFCOMMANDS="set xserver-xorg/autodetect_keyboard true\n"
. DEBCONFCOMMANDS="fset xserver-xorg/autodetect_keyboard seen true\n$DEBCONFCOMMANDS"
. echo "$DEBCONFCOMMANDS" | chroot /root debconf-communicate -fnoninteractive > /dev/null
}
] 30
{ 30
[ 36
. chroot /root debconf-communicate -fnoninteractive > /dev/null <<EOF
] 36
{ 36
. chroot /root debconf-communicate -fnoninteractive casper > /dev/null <<EOF
}
. set xserver-xorg/autodetect_keyboard true
. fset xserver-xorg/autodetect_keyboard seen true
. EOF
}
. 
}
[ 33
. LANG=$(grep ^$locale /root/usr/share/i18n/SUPPORTED | sed -e 's, .*,,' -e q) casper-reconfigure xserver-xorg
}
] 33
{ 33
[ 34
. LANG=$(grep ^$locale /root/usr/share/i18n/SUPPORTED | sed -e 's, .*,,' -e q) casper-reconfigure /root xserver-xorg
}
] 34
{ 34
[ 35
. DEBUG_XORG_PACKAGE=1 DEBUG_XORG_DEBCONF=1 LANG=$(grep ^$locale /root/usr/share/i18n/SUPPORTED | sed -e 's, .*,,' -e q) casper-reconfigure /root xserver-xorg
}
] 35
{ 35
. DEBUG_XORG_PACKAGE=1 DEBUG_XORG_DEBCONF=1 LANG=$(grep "^${locale}" /root/usr/share/i18n/SUPPORTED | grep UTF-8 | sed -e 's, .*,,' -e q) casper-reconfigure /root xserver-xorg
}
. umount /root/sys
. umount /root/proc
}
{ 31
. 
. log_end_msg
}
{ 32
. 
. log_end_msg
}
W
